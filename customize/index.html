<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Customizing Autoware </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Customizing Autoware ">
      
      <link rel="icon" href="../favicon.ico">
      <link rel="stylesheet" href="../public/docfx.min.css">
      <link rel="stylesheet" href="../public/main.css">
      <meta name="docfx:navrel" content="../toc.html">
      <meta name="docfx:tocrel" content="toc.html">
      
      
      
      
      <meta name="docfx:docurl" content="https://github.com/AutomotiveAIChallenge/aichallenge2023-integ/blob/main/documentation/docfx_project/customize/index.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
  </head>

  <script type="module" src="./../public/docfx.min.js"></script>

  <script>
    const theme = localStorage.getItem('theme') || 'auto'
    document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
  </script>


  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../index.html">
            <img id="logo" class="svg" src="../logo.svg" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" style="margin-top: -.65em; margin-left: -.8em" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="customizing-autoware">Customizing Autoware</h1>

<p>本ページでは、既存のAutowareをカスタマイズし、自作のパッケージなどを追加する方法を紹介します．</p>
<p>また、デフォルトのAutowareから機能を絞り、最小構成のAutoware「Autoware Mini」の紹介もしています．</p>
<h2 id="how-to-customize-and-use-autoware-packages">How to customize and use Autoware packages</h2>
<ol>
<li>元のパッケージをコピーして、下記を変更
<ul>
<li>パッケージ名</li>
<li>フォルダ名</li>
<li>コード</li>
<li>package.xml</li>
<li>CMakeLists.txt</li>
</ul>
</li>
<li>aichallenge_submitの中に配置</li>
<li>autoware_universe_launchから呼び出されるlaunchファイルを変更
<ul>
<li>参考例：pose_initializer_custom（ autoware_universe_launch/tier4_localization_launch/launch/util/util.launch.xmlから呼び出しております）</li>
</ul>
</li>
</ol>
<h2 id="autoware-mini">Autoware-Mini</h2>
<p>デフォルトのAutowareでは様々な走行環境に対応するため、たくさんのノードから構成されています．</p>
<p>Autowareの公式ドキュメンテーションでは、<a href="https://autowarefoundation.github.io/autoware-documentation/main/design/autoware-architecture/node-diagram/">Autowareを構成するROSノードの構成図</a>を見ることもできます．以下に現時点の図を示します．</p>
<p><img src="../images/customize/autoware-node-diagram.png" alt="node-diagram"></p>
<p>自動運転に関わる各コンポーネントで多種多様な機能を揃えており、難易度の高い走行環境にも対応できるように作られています．</p>
<p>一方、その複雑な構成を理解し、各パラメータの意味や調整の仕方、モジュールの切り替え・入れ替えなどを行うことが必ずしも容易ではなくなっています．</p>
<p>そのため、今回は、デフォルトのAutowareから機能を絞り、ノード数を減らした<a href="https://github.com/AutomotiveAIChallenge/aichallenge2023-sim/blob/main/docker/aichallenge/aichallenge_ws/src/aichallenge_submit/aichallenge_submit_launch/launch/autoware_mini_awsim.launch.xml">最小構成のAutoware「Autoware-Mini」を起動できるLaunchファイル</a>を用意しました．</p>
<p>Autoware-Miniのノード図を以下に示します．ノード数が格段と減り、基本的な自動走行を可能とする機能のみが揃っていることが分かります．</p>
<p><img src="../images/customize/autoware-mini-node-diagram.png" alt="mini-node-diagram"></p>
<p>Autoware-Miniの特徴としては、以下が挙げられます．</p>
<ul>
<li>ほぼ全てのノードの起動を直接1つのLaunchファイルから行っている．既存のAutowareでは、Launchファイルが何重にも分かれており、実際にノードが起動する箇所に辿り着くまでLaunchファイルをいくつも辿っていく必要がある．</li>
<li>パラメータを直接ノード起動時に書き込んでいるため、どのパラメータがどのノードで必要なのかを簡単に追うことができる．</li>
<li>各ノードの入出力となるROSトピック名も直接ノード起動時に<code>remap</code>しているため、トピック名も簡単に変えられる．</li>
</ul>
<p>このAutoware-Miniをベースに自動運転ソフトを書くことで、以下のようなことができます．</p>
<ul>
<li>シンプルな構成となっているため、Autowareの中身をより深く理解できる</li>
<li>自作のモジュールをAutowareのものと簡単に入れ替えることができ、機能の改善に取り組める</li>
<li>パラメータを変更した場合のシステム全体の動作への影響が分かりやすい</li>
<li>今回のAutoware-Miniには含まれていない既存のAutowareのノードを追加することもできる</li>
</ul>
<h3 id="using-autoware-mini">Using Autoware-Mini</h3>
<p>Autoware-Miniのセットアップと使い方を説明します．</p>
<h4 id="pulling-newest-changes-from-github">Pulling newest changes from GitHub</h4>
<p>既に<code>aichallenge2023-sim</code>をセットアップしていた方は、以下を実行し、最新のソースをmainブランチからPullしてください．</p>
<pre><code>cd aichallenge2023-sim/
git pull
</code></pre>
<p>Autoware-MiniのLaunchファイルは<code>aichallenge2023-sim/docker/aichallenge/aichallenge_ws/src/aichallenge_submit/aichallenge_submit_launch/launch/autoware_mini_awsim.launch.xml</code> (<a href="https://github.com/AutomotiveAIChallenge/aichallenge2023-sim/blob/main/docker/aichallenge/aichallenge_ws/src/aichallenge_submit/aichallenge_submit_launch/launch/autoware_mini_awsim.launch.xml">GitHubリンク</a>) にあります．</p>
<h4 id="updating-aichallenge_submitlaunchxml">Updating aichallenge_submit.launch.xml</h4>
<p><code>autoware_mini_awsim.launch.xml</code>を起動するためには、<code>aichallenge_submit.launch.xml</code>をまず修正する必要があります．</p>
<p>このファイルのコメントアウトしている箇所を有効にし、上の<code>e2e_simulator.launch.xml</code>を起動している箇所をコメントアウトしてください．</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;launch&gt;
    &lt;!-- Autoware --&gt;
    &lt;!-- &lt;include file=&quot;$(find-pkg-share autoware_launch)/launch/e2e_simulator.launch.xml&quot;&gt;
        &lt;arg name=&quot;vehicle_model&quot; value=&quot;golfcart&quot;/&gt;
        &lt;arg name=&quot;sensor_model&quot; value=&quot;awsim_sensor_kit&quot;/&gt;
        &lt;arg name=&quot;map_path&quot; value=&quot;/aichallenge/mapfile&quot;/&gt;
        &lt;arg name=&quot;rviz&quot; value=&quot;false&quot;/&gt;
    &lt;/include&gt; --&gt;

    &lt;!-- Uncomment the following lines to try Autoware-Mini --&gt;
    &lt;include file=&quot;$(find-pkg-share aichallenge_submit_launch)/launch/autoware_mini_awsim.launch.xml&quot; &gt;
      &lt;arg name=&quot;vehicle_model&quot; value=&quot;golfcart&quot;/&gt;
      &lt;arg name=&quot;sensor_model&quot; value=&quot;awsim_sensor_kit&quot;/&gt;
      &lt;arg name=&quot;map_path&quot; value=&quot;/aichallenge/mapfile&quot;/&gt;
      &lt;arg name=&quot;rviz&quot; value=&quot;false&quot;/&gt;
    &lt;/include&gt;

    &lt;include file=&quot;$(find-pkg-share initialpose_publisher)/launch/initialpose_publisher.launch.xml&quot; /&gt;

    &lt;include file=&quot;$(find-pkg-share self_driving_controller)/launch/self_driving_controller.launch.xml&quot; /&gt;
&lt;/launch&gt;
</code></pre>
<h4 id="updating-aichallengelaunchxml">Updating aichallenge.launch.xml</h4>
<p>次に、Autowareを起動した際のGUIツールRviz2の見た目を変えるため、Rviz2コンフィグファイルをAutoware-Mini用のものに設定します．</p>
<p><code>aichallenge.launch.xml</code>を以下のように変えます．</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;launch&gt;
    &lt;!-- RViz parameters --&gt;
    &lt;arg name=&quot;rviz2&quot; default=&quot;true&quot; description=&quot;launch rviz&quot;/&gt;
    &lt;!-- &lt;arg name=&quot;rviz_config&quot; default=&quot;$(find-pkg-share autoware_launch)/rviz/autoware.rviz&quot; description=&quot;rviz config&quot;/&gt; --&gt;

    &lt;!-- Below is a more suitable RViz2 config for trying out Autoware-Mini --&gt;
    &lt;arg name=&quot;rviz_config&quot; default=&quot;$(find-pkg-share autoware_launch)/rviz/autoware-mini.rviz&quot; description=&quot;rviz config&quot;/&gt;

    &lt;!-- Scoring --&gt;
    &lt;include file=&quot;$(find-pkg-share aichallenge_scoring)/launch/aichallenge_scoring.launch.xml&quot;&gt;
        &lt;arg name=&quot;result_score_topic&quot; value=&quot;/aichallenge/score&quot; /&gt;
    &lt;/include&gt;

    &lt;node pkg=&quot;aichallenge_scoring_result&quot; exec=&quot;scoring_result&quot; name=&quot;scoring_result&quot; output=&quot;screen&quot; /&gt;

    &lt;!-- Submitted Package --&gt;
    &lt;include file=&quot;$(find-pkg-share aichallenge_submit_launch)/launch/aichallenge_submit.launch.xml&quot; /&gt;

    &lt;!-- RViz --&gt;
    &lt;group&gt;
        &lt;node pkg=&quot;rviz2&quot; exec=&quot;rviz2&quot; name=&quot;rviz2&quot; output=&quot;screen&quot; args=&quot;-d $(var rviz_config) -s $(find-pkg-share autoware_launch)/rviz/image/autoware.png&quot; if=&quot;$(var rviz2)&quot;/&gt;
    &lt;/group&gt;
&lt;/launch&gt;
</code></pre>
<h4 id="updating-behavior_path_plannerparamyaml">Updating behavior_path_planner.param.yaml</h4>
<p>次に、Planningコンポーネントの<code>behavior_path_planner</code>と<code>behavior_velocity_planner</code>においては、設定を以下のコンフィグファイルで行う必要があります．</p>
<ul>
<li><a href="https://github.com/AutomotiveAIChallenge/aichallenge2023-sim/blob/main/docker/aichallenge/aichallenge_ws/src/aichallenge_submit/autoware_launch/autoware_launch/config/planning/scenario_planning/lane_driving/behavior_planning/behavior_path_planner/behavior_path_planner.param.yaml">behavior_path_planner.param.yaml</a></li>
<li><a href="https://github.com/AutomotiveAIChallenge/aichallenge2023-sim/blob/main/docker/aichallenge/aichallenge_ws/src/aichallenge_submit/autoware_launch/autoware_launch/config/planning/scenario_planning/lane_driving/behavior_planning/behavior_velocity_planner/behavior_velocity_planner.param.yaml">behavior_velocity_planner.param.yaml</a></li>
</ul>
<p>デフォルトのAutowareでは、<code>behavior_path_planner</code>ノードでは、以下のモジュールを有効化しています．</p>
<ul>
<li>lane_change</li>
<li>pull_out</li>
<li>side_shift</li>
<li>pull_over</li>
<li>avoidance</li>
</ul>
<p>今回のAutoware-Miniでは、一旦ここ全てをOFFにするよう変更を加えます．</p>
<pre><code>...

lane_change:
  enable_module: false
  enable_simultaneous_execution: false
  priority: 4
  max_module_size: 1

pull_out:
  enable_module: false
  enable_simultaneous_execution: false
  priority: 0
  max_module_size: 1

side_shift:
  enable_module: false
  enable_simultaneous_execution: false
  priority: 2
  max_module_size: 1

pull_over:
  enable_module: false
  enable_simultaneous_execution: false
  priority: 1
  max_module_size: 1

avoidance:
  enable_module: false
  enable_simultaneous_execution: false
  priority: 3
  max_module_size: 1

</code></pre>
<h4 id="updating-behavior_velocity_plannerparamyaml">Updating behavior_velocity_planner.param.yaml</h4>
<p>次に、Planningコンポーネントの<code>behavior_path_planner</code>と<code>behavior_velocity_planner</code>においては、設定を以下のコンフィグファイルで行う必要があります．</p>
<ul>
<li><a href="https://github.com/AutomotiveAIChallenge/aichallenge2023-sim/blob/main/docker/aichallenge/aichallenge_ws/src/aichallenge_submit/autoware_launch/autoware_launch/config/planning/scenario_planning/lane_driving/behavior_planning/behavior_path_planner/behavior_path_planner.param.yaml">behavior_path_planner.param.yaml</a></li>
<li><a href="https://github.com/AutomotiveAIChallenge/aichallenge2023-sim/blob/main/docker/aichallenge/aichallenge_ws/src/aichallenge_submit/autoware_launch/autoware_launch/config/planning/scenario_planning/lane_driving/behavior_planning/behavior_velocity_planner/behavior_velocity_planner.param.yaml">behavior_velocity_planner.param.yaml</a></li>
</ul>
<p>デフォルトのAutowareでは、<code>behavior_velocity_planner</code>ノードでは、以下のモジュールを有効化しています．</p>
<pre><code>...
launch_stop_line: true
launch_crosswalk: true
launch_traffic_light: true
launch_intersection: true
launch_blind_spot: true
launch_detection_area: true
launch_virtual_traffic_light: true
launch_occlusion_spot: false
launch_no_stopping_area: true
launch_run_out: false
launch_speed_bump: false
</code></pre>
<p>今回のAutoware-Miniでは、一旦「stop-line」以外を全てOFFにするよう変更を加えます．</p>
<pre><code>...
# Autoware-Mini (Uncomment the lines below to try Autoware-Mini)
launch_stop_line: true
launch_crosswalk: false
launch_traffic_light: false
launch_intersection: false
launch_blind_spot: false
launch_detection_area: false
launch_virtual_traffic_light: false
launch_occlusion_spot: false
launch_no_stopping_area: false
launch_run_out: false
launch_speed_bump: false
</code></pre>
<h4 id="run-autoware-mini">Run Autoware-Mini</h4>
<p>これでAutoware-Miniを動かす準備はできました．AWSIMを起動し、以下でAutoware-Miniを実行します．</p>
<pre><code># Rockerコンテナ内で
cd /aichallenge
bash build.sh
bash run.sh
</code></pre>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/AutomotiveAIChallenge/aichallenge2023-integ/blob/main/documentation/docfx_project/customize/index.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>


    <footer class="border-top">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>
